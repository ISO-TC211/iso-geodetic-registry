<div th:fragment="itemClassSelector">
	<div class="form-group">
		<label class="form-label" for="itemClass" th:text="#{form.label.itemClass}">Item-Klasse</label>
		<div class="controls">
			<div class="input-group">
				<input type="hidden" th:if="${partOfSupersession}" th:field="*{itemClassUuid}" th:value="${itemClassUuid}"/>
				<select id="itemClass" required="true" th:field="*{itemClassUuid}" th:disabled="${partOfSupersession}">
					<option th:text="#{form.select.choose}" value="" th:unless="${itemClassUuid}"/>
					<option th:each="anItemClass : ${register.getContainedItemClasses()}"
							th:value="${anItemClass.uuid}"
							th:text="#{${anItemClass.name}}"></option>
				</select>
			</div>
		</div>
	</div>

	<div th:unless="${itemClass}">
		<button id="cancel" onClick="history.back();" type="button" name="cancel" class="btn btn-default" th:text="#{button.cancel}">Abbrechen</button>
	</div>
</div>

<div th:fragment="itemClassNotConfiguredWarning">
	<div th:if="${itemClassNotConfigured}" class="alert alert-danger">
		<p th:text="#{form.proposal.itemClassNotConfigured}">Konfiguration f√ºr Itemklasse nicht vorhanden.</p>
	</div>
</div>

<div th:fragment="input (property, inputType, label, placeholder, isRequired)" class="form-group" th:classappend="${isRequired} ? 'has-feedback'">
	<label class="control-label" th:for="${property}" th:text="${label}"></label>
	<input th:id="${property}" th:name="${property}" th:placeholder="${placeholder}" class="form-control" th:classappend="${isRequired} ? 'required'" th:required="${isRequired}" th:type="${inputType}" th:field="*{__${property}__}" />
	<span th:if="${isRequired}" class="glyphicon glyphicon-hand-left form-control-feedback" th:title="#{mandatoryField}"></span>
</div>

<!-- Parameters: property, rows, cols, inputType, label, placeholder, isRequired -->
<div th:fragment="textArea" class="form-group" th:classappend="${isRequired} ? 'has-feedback'"> 
	<label class="control-label" th:for="${property}" th:text="${label}"></label>
	<textarea th:id="${property}" th:name="${property}" th:rows="${rows}" th:cols="${cols}" th:placeholder="${placeholder}" class="form-control" th:classappend="${isRequired} ? 'required'" th:required="${isRequired}" th:field="*{__${property}__}"/>
	<span th:if="${isRequired}" class="glyphicon glyphicon-hand-left form-control-feedback" th:title="#{mandatoryField}"></span>
</div>

<div th:fragment="nameAndCode">
	<div class="col-md-8" th:with="property='name',inputType='text',label=#{form.label.name},placeholder=#{form.placeholder.name},isRequired='true'">
		<div th:replace="registry/registers/globals :: input"/>
	</div>
	<div class="col-md-4" th:with="property='code',inputType='code',label=#{form.label.code},placeholder=#{form.placeholder.code},isRequired='true'">
		<div th:replace="registry/registers/globals :: input"/>
	</div>
</div>


<div th:fragment="remarks (cssClass)">
	<div th:classappend="${cssClass}" th:with="property='remarks',rows=2,cols=60,label=#{form.label.remarks},placeholder=#{form.placeholder.remarks},isRequired='false'">
		<div th:replace="registry/registers/globals :: textArea"/>
	</div>
</div>

<div th:fragment="informationSource (cssClass)">
	<div th:classappend="${cssClass}" th:with="property='informationSource',rows=2,cols=60,label=#{form.label.informationSource},placeholder=#{form.placeholder.informationSource},isRequired='false'">
		<div th:replace="registry/registers/globals :: textArea"/>
	</div>
</div>

<div th:fragment="dataSource (cssClass)">
	<div th:classappend="${cssClass}" th:with="property='dataSource',rows=2,cols=60,label=#{form.label.dataSource},placeholder=#{form.placeholder.dataSource},isRequired='true'">
		<div th:replace="registry/registers/globals :: textArea"/>
	</div>
</div>

<div th:fragment="proposalDetailsPanel (isCollapsible)" class="panel panel-default" th:if="${itemClass}">
	<div class="panel-heading">
		<div th:if="${isCollapsible}">
			<a data-toggle="collapse" data-parent="#accordion" href="#managementPanel">
				<span class="panel-title" th:text="#{header.proposalDetails}">Details for proposal</span>									
			</a>
			<div class="pull-right">
				<span class="glyphicon glyphicon-chevron-right"></span>
			</div>
		</div>
		<h3 th:unless="${isCollapsible}" class="panel-title" th:text="#{header.proposalDetails}">Details for proposal</h3>
	</div>

	<div id="managementPanel" th:classappend="${isCollapsible} ? 'panel-collapse collapse'">
		<div class="panel-body">
			<div th:fragment="proposalDetails">
				<div th:with="property='definition',rows=6,cols=120,label=#{form.label.definition},placeholder=#{form.placeholder.definition},isRequired='true'">
					<div th:replace="registry/registers/globals :: textArea"/>
				</div>
				<div th:unless="${partOfSupersession}">
					<div th:with="property='justification',rows=6,cols=120,label=#{form.label.justification},placeholder=#{form.placeholder.justification},isRequired='true'">
						<div th:replace="registry/registers/globals :: textArea"/>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>			

<div th:fragment="proposalButtons" class="form-group" th:if="${itemClass}">
	<div class="controls">
		<button id="cancel" type="button" onClick="history.back();" name="cancel" class="btn btn-default" th:text="#{button.cancel}">Abbrechen</button>
		<div class="pull-right">
			<button id="saveProposal" name="saveProposal" class="btn btn-default" th:text="#{button.saveProposal}">Speichern</button>
			<button id="submit" name="submit" class="btn btn-primary" th:text="#{button.submitProposal}">Speichern</button>
			<div class="row">
				<div id="pleaseWait" class="pull-right"><img th:src="@{__${basePath}__/resources/images/loader.gif}"/></div>
			</div>
		</div>
	</div>
</div>

<div th:fragment="defaultProposalHiddenFields">
	<input type="hidden" th:field="*{itemUuid}"/>
	<input type="hidden" th:field="*{proposalUuid}"/>
	<input type="hidden" th:field="*{targetRegisterUuid}"/>
	<input type="hidden" th:field="*{sponsorUuid}"/>
	<input type="hidden" th:field="*{proposalType}"/>					
</div>

<script th:fragment="js-proposal" type="text/javascript" th:inline="text">
/* <![CDATA[ */
	$(document).ready(function() {
		$('#itemClass').on('change', function() {
	  		//alert( this.value ); // or $(this).val()
	  		if ([[${param.addNew} ? 'true' : 'false']]) {
	  			location.href = window.location.pathname + '?addNew=&itemClass=' + this.value;
	  		}
	  		else {
	  			location.href = window.location.pathname + '?itemClass=' + this.value;
	  		}
		});

		$('#validationFailed').hide();
		$('#pleaseWait').hide();

		$('#proposal').validate({
			ignore: '',
// 			debug: true,
			invalidHandler: function(event, validator) {
				// 'this' refers to the form
				var errors = validator.numberOfInvalids();
				$('#validationFailed').show();				
			},
			submitHandler: function(form) {
				$('#pleasewait').show();
	 			$('button').each(function() {
					$(this).attr('disabled', 'disabled');
				});
				
				form.submit();
				return true;
			},
			messages: {
				name: "[[#{button.cancel}]]"
			},
			errorClass: "has-error",
			errorPlacement: function(error, element) {
			},
			highlight: function(element, errorClass, validClass) {
				$(element).addClass(errorClass).removeClass(validClass);
				$(element).closest(".form-group").addClass(errorClass);
			},
			unhighlight: function(element, errorClass, validClass) {
				$(element).removeClass(errorClass).addClass(validClass);
				$(element).closest(".form-group").removeClass(errorClass);
			}			
		});
	});
/* ]]> */
</script>
